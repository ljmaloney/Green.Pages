## Amazon Web Services
All of the deployment files for AWS can be found under the aws directory in this folder.
-- use setup_fusionauth_ec2.sh for installation using EC2 container (demo purposes only)

### Manual Deployment Process using AWS Resources & Fargate
1. Create A Virtual Private Cloud or use the default VPC for the account
   1. The security groups will require ports 80, 443, and 5432 to be opened
2. Create PostgreSql RDS instance
   1. Go to Aurora and RDS
   2. Click DB Instances or Databases
   3. Click "Create Database"
   4. Select PostgreSQL
   5. Select the deployment model (free tier is db.t4g.micro)
   6. Enter a database name/identifier
   7. Use self-managed, and select auto-generate password
   8. Select the VPC created in step above
   9. Select the security groups, the security groups must allow ingress and egress using the PostgreSQL port. As an alternative, you can create a jump-box using an EC2 instance, and connect the EC2 instance to Postgres
   10. Select an availability zone
   11. Click "Create"
   12. Make a note of the password generated by AWS when the database is provisioned for the postgres user id
   13. Copy the JDBC URL from the "Connectivity and Security" tab
   14. Connect to the Postgres instance from either the jump box or IDE then
       1. Create the fusionauth database
       2. Create the fusionauth user and set the password (this password is required to configure fusionauth)
       3. Grant privileges to the new user
3. Optionally - Provision Opensearch **this is not required for the deployment of FusionAuth
4. Provision SES for your domain (also optional). This involves several steps
   1. Follow the steps to setup and validate the domain
   2. Once the domain is validated, go to SMTP Settings and copy the SMTP endpoint
   3. When creating the IAM access user / key take not of the AccessKey and password, the AccessKey is used to configure the SMTP settings in fusionAuth
5. Define the FusionAuth task in ECS
   1. Go to Elastic Container Service, Task definitions, create a new task definition
   2. Enter a task family name
   3. Select AWS Fargate under LaunchType
   4. Select the ecsTaskExecutionRole for both taskRole and Task execution role
   5. Specify the container image URI for FusionAuth - fusionauth/fusionauth-app:latest
   6. Use the default port mapping for FusionAuth (9011)
   7. Configure the secrets, environment variables, or an .env file from S3
6. Create the AWS ECS cluster for fusion auth
   1. Go to AWS Elastic Container Service - Clusters - Create Cluster
   2. Enter the name for the cluster **fusionauth-cluster**
   3. Select "AWS Fargate" under infrastructure
   4. Click "Create"
7. Deploy the task (create the service) into the cluster
   1. Go to AWS Elastic Container Service - > Task Definitions
   2. Select the task created above
   3. Click "Deploy" drop down then select "Create Service", in the service creation process
      1. Create the application load balancer and target for the service
   4. The service will be deployed and started
8. Assuming everything has gone as planned, 
   1. open the load balancer and copy the DNS name
   2. Past the DNS name into the browser address bar, and see the FusionAuth welcome page

### Terraform - https://developer.hashicorp.com/terraform
The terraform environment configuration / deployment configuration files are located in the terraform folder. The scripts 
include the provisioning of FusionAuth dependencies and a load balancer
1. 1_create_vpc.tf - provisions the Virtual Private Cloud
2. 2_create_postgres_rds.tf - provisions the PostgreSql instance
3. 3_provision_opensearch.tf - provisions opensearch used by FusionAuth
4. 4_fusionauth_cluster.tf - provisions the fargate cluster, container, task, and service
5. 5_alb.tf - provisions the Application Load Balancer
6. 6_identity_access_management.tf